# 8.1 虚拟存储背景

虚拟：内存放到外存的做法 覆盖 交换

os的抽象对象：地址空间(抽象各种外设)

覆盖：手动把数据命令留在内存

对换：自动把用不到的数据换到外村

# 8.2 覆盖和交换

覆盖：程序大于内存？就是划分程序，先将模块独立的分为一组，在内外存中不断交换。

覆盖技术实例：用每级最大的空间？可以自由分组

不足：编程困难(自己划分模块) 增加时间(从外存装入)



交换：将暂时不用的进程换出 换入换出基本单位：整个进程

时机和大小和位置(采用动态映射)都需要考虑

# 8.3 局部性原理/虚拟存储

目标：物理内存+磁盘=虚拟存储

在内外存之间只交换进程的部分内容

局部性原理：时间局部性 空间局部性 分支局部性

# 8.4 虚拟存储概念

装载程序时，只将需要执行的放到内存中/需要调入出页面机制/需要watch暂时不用的

需要硬件：页式或短时存储中的地址转换

os：管理内外存之间的换入换出

# 8.5 虚拟页式存储

在页式管理上面加上请求调页和页面置换。

需要在页表项中加上一些标志位。

驻留位：该页面是否在内存当中

修改位：是否被修改

访问位：是否被访问

保护位：访问权限

虚拟存储实例：x86页表项结构 有很多位 直写(就是写到cpu和缓存之间的寄存器中，如果需要io，或者影响语义，那么可以直写) 还有一些保留位(因为x86系统中的内存不止是4g)

# 8.6 缺页异常

缺页流程：

![image-20210623202804896](C:\Users\12092\AppData\Roaming\Typora\typora-user-images\image-20210623202804896.png)

**如何保存未被映射的页？：**

​	方便找到在外存中的页面内容

​	交换空间

虚拟页式存储中的外存选择：代码段、共享程序段、其他段

时间：EAT=10(1-p)+5000000p(1+q)  缺页+页修改